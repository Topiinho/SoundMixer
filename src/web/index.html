<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonus Mixer</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- CSS Modular -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- Preload critical resources -->
    <link rel="preload" href="assets/logo.png" as="image">
    <link rel="preload" href="assets/profile-default.svg" as="image">
</head>
<body>
    <!-- App container com semantic HTML -->
    <div class="app-container" role="application" aria-label="Sonus Mixer">
        <!-- Sidebar navigation -->
        <nav class="sidebar" role="navigation" aria-label="Menu principal">
            <header class="sidebar-header">
                <img src="assets/logo.png" alt="Sonus Mixer Logo" class="app-logo-img" width="50" height="50">
                <h1 class="app-title">Sonus Mixer</h1>
            </header>

            <ul class="nav-menu" role="tablist">
                <li class="nav-item" role="none">
                    <a href="#" class="nav-link active" role="tab" aria-selected="true" data-screen="apps">
                        <i class="fas fa-sliders" aria-hidden="true"></i>
                        <span>Aplicativos</span>
                    </a>
                </li>
                <li class="nav-item" role="none">
                    <a href="#" class="nav-link" role="tab" aria-selected="false" data-screen="channels">
                        <i class="fas fa-broadcast-tower" aria-hidden="true"></i>
                        <span>Faixas de √Åudio</span>
                    </a>
                </li>
                <li class="nav-item" role="none">
                    <a href="#" class="nav-link" role="tab" aria-selected="false" data-screen="devices">
                        <i class="fas fa-microphone" aria-hidden="true"></i>
                        <span>Dispositivos</span>
                    </a>
                </li>
            </ul>

            <!-- Profile section -->
            <aside class="profile-section">
                <button class="profile-card" id="profile-card" aria-describedby="profile-popup" aria-expanded="false">
                    <img src="assets/profile-default.svg" alt="Avatar do usu√°rio" class="profile-avatar" id="profile-avatar" width="48" height="48">
                    <div class="profile-info">
                        <span class="profile-name" id="profile-name">Vitor Pinho</span>
                        <span class="profile-status" aria-label="Status online">üü¢ Online</span>
                    </div>
                    <div class="profile-menu-btn" aria-hidden="true">
                        <i class="fas fa-chevron-up"></i>
                    </div>
                </button>

                <!-- Profile popup -->
                <div class="profile-popup" id="profile-popup" role="menu" aria-hidden="true">
                    <div class="popup-option" id="startup-toggle" role="menuitem">
                        <i class="fas fa-power-off" aria-hidden="true"></i>
                        <span>Iniciar com o sistema</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="startup-checkbox" checked aria-label="Iniciar com o sistema">
                            <label for="startup-checkbox"></label>
                        </div>
                    </div>

                    <button class="popup-option" id="change-nickname" role="menuitem">
                        <i class="fas fa-edit" aria-hidden="true"></i>
                        <span>Trocar nickname</span>
                        <i class="fas fa-chevron-right" aria-hidden="true"></i>
                    </button>

                    <button class="popup-option" id="change-avatar" role="menuitem">
                        <i class="fas fa-image" aria-hidden="true"></i>
                        <span>Trocar foto de perfil</span>
                        <i class="fas fa-chevron-right" aria-hidden="true"></i>
                    </button>
                </div>
            </aside>
        </nav>

        <!-- Main content area -->
        <main class="main-content" role="main">
            <header class="content-header">
                <h1 class="title" id="page-title">
                    <i class="fas fa-sliders" aria-hidden="true"></i>
                    Carregando...
                </h1>
                <div id="master-volume-container" role="region" aria-label="Controle de volume master">
                    <!-- Master controls inseridos via JavaScript -->
                </div>
            </header>

            <section class="content-body" role="tabpanel" id="main-content-area">
                <div class="loading" aria-live="polite">üéõÔ∏è Carregando...</div>
            </section>
        </main>
    </div>

    <!-- Error boundary -->
    <div id="error-boundary" class="error-boundary" style="display: none;" role="alert">
        <h2>Ops! Algo deu errado</h2>
        <p>Ocorreu um erro inesperado. Recarregue a p√°gina.</p>
        <button onclick="window.location.reload()" class="error-reload-btn">Recarregar</button>
    </div>

    <!-- JavaScript -->
    <script>
        // Feature detection
        if (!window.Promise || !window.fetch || !window.Map) {
            document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>Browser n√£o suportado</h2><p>Use um browser moderno (Chrome, Firefox, Safari, Edge)</p></div>';
        } else {
            // Carregar aplica√ß√£o principal
            import('./js/main-refactored.js').catch(error => {
                console.error('Erro ao carregar vers√£o refatorada:', error);
                // Fallback para vers√£o original
                const script = document.createElement('script');
                script.src = 'js/mixer.js';
                document.head.appendChild(script);
            });
        }
    </script>

    <!-- Service Worker para cache (futuro) -->
    <!--
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }
    </script>
    -->
</body>
</html>